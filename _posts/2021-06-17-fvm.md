---
layout: distill
title: Finite Volume - A powerful relict that just won't go away
description: How a rather hands-on way of thinking has been revolutionizing fluid mechanics
date: 2021-06-15

authors:
  - name: Patrick Zimbrod
    affiliations:
      name: Applied Computer Science, Augsburg
  

bibliography: 2021-06-17-numerics.bib

# Below is an example of injecting additional post-specific styles.
# If you use this post as a template, delete this _styles block.
_styles: >
  .fake-img {
    background: #bbb;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 0px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 12px;
  }
  .fake-img p {
    font-family: monospace;
    color: white;
    text-align: left;
    margin: 12px 0;
    text-align: center;
    font-size: 16px;
  }

---

In contrast to the FDM, we're now not considering singular points or vertices of your domain, but rather a cell where inside a portion of the overall physics happens. This way of thinking is fundamentally different and one could argue that it stems from a more "engineering" way of thinking. The motivation stems from the idea that you would split an integral solution of a problem into a specific (finite) amount of subdomains, each with their own solution. This method is especially prominent in fluid dynamics, where dealing with conservation equations is quite common <d-cite key="eymardFiniteVolumeMethods2000"></d-cite>.

Consequently, we are not considering differential forms of the physics considered as in the FDM, but rather the conservative form that describes the physics on the entire domain. One typical equation with a conserved quantity $\phi$ would then look something like:

$$
\iiint\limits_V\frac{\partial \rho \phi}{\partial t} dV + \underbrace{\iiint\limits_V \frac{\partial}{\partial x_i} (\rho u_i \phi) dV}_{\text{Convection}} - \underbrace{\iiint\limits_V \frac{\partial}{\partial x_i} (\rho \Gamma_\phi \frac{\partial \phi}{\partial x_i} ) dV}_\text{Diffusion} - \underbrace{\iiint\limits_V S_\phi(\phi) dV}_\text{Source} = 0
$$

Again, we need to find some means of discretizing this expression in space (and time). Characteristic of the Finite volume Method is the application of Gauss' divergence theorem so that the volume integrals become hull integrals over the faces of the domain:

$$
\iiint\limits_V \frac{\partial u_i}{\partial x_i} dV = \oint\limits_{\partial V} u_i \cdot n_i dS = \oint\limits_{\partial V} u_i dS_i
$$

We now split the global domain into separate, finite subcells so that we can write the conservation equation using finite sums:

$$
\oint\limits_{\partial V} (\rho u_i \phi)dS_i = \sum\limits_f \oint\limits_f (\rho u_i \phi)_f dS_i \approx \sum\limits_f \sum\limits_i \underbrace{\overline{(\rho u_i \phi)}_f}_\text{mid point rule} S_{if} = \sum\limits_f \sum\limits_i (\rho u_i \phi)_f S_{if}
$$

To this day, FVM remains a popular choice for dealing with flow phenomena of many sorts. But this method also is not without its flaws. We will try to sketch the most problematic in short. For now, reimagine the idea of FVM in terms of neighboring cells. You can then convince yourself that in a 3D domain, each volume shares a common face with a neighboring cell. Due to the way FVM is set up using Gauss' theorem, the values of one cell needs to be reconstructed by the values on the faces. This leads to the problem that for one face, you have multiple values that the one on the face could assume. So how choose? This kind of discontinuity poses an important problem and there are many ways to deal with this. One way for example is to simply take the value of the upwind cell, which consequently is known as upwind differencing. This method, however being stable, can produce highly diffusive solutions which in turn is undesirable. There are other methods that tend to exhibit opposite behavior. Achieving both relative stability and low diffusivity is often more art than science.

One example for the tradeoff you have to make regarding stability and diffusivity is given in the figure below.

[Comparison of different numerical schemes for a shock problem in 2D <d-cite key="roostaeiEvaluationNumericalSchemes2017"></d-cite>](../assets/img/shock-problem-fvm.png)

You can clearly observe that the schemes that preserve the sharp concentration gradient at about 3.5 m length tend to produce (unphysical) oscillations. In contrast, the typically diffusive upwind scheme keeps the overall concentration within the set bounds but produces a somewhat "mushy" zone around the shock area. This is a very typical setting and illustrates the difficulty of choosing an appropriate scheme for your problem.